<!DOCTYPE html>
<html>

	<head>
		<title>obj test </title>
		<script type="text/javascript" src="jquery-1.12.4.js"></script>
		<script type="text/javascript" src="libs/three.js"></script>
		<script type="text/javascript" src="libs/OBJLoader.js"></script>
		<script type="text/javascript" src="libs/MTLLoader.js"></script>
		<script type="text/javascript" src="libs/OBJMTLLoader.js"></script>
		<script type="text/javascript" src="libs/TGALoader.js"></script>
		<script type="text/javascript" src="libs/TrackballControls.js"></script>
		<!--<script src="dat.gui.js"></script>-->
		<!--<script type="text/javascript" src="assets/fonts/helvetiker_regular.typeface.js"></script>
		<script type="text/javascript" src="assets/fonts/helvetiker_bold.typeface.js"></script>
		<script type="text/javascript" src="assets/fonts/bitstream_vera_sans_mono_roman.typeface.js"></script>-->
		<style>
			body {
				/* set margin to 0 and overflow to hidden, to go fullscreen */
				margin: 0;
				overflow: hidden;
			}
		</style>
	</head>

	<body>
		<div style="width:100%">
			<div id="WebGL-output" style="width:80%;height:80%">
			</div>
		</div>
		<script type="text/javascript">
			$('.exit').click(function() {
				window.history.back(-1);
			})
			var mesh;
//			var sphere;
			var geoms = [];
			var textMesh;
			var webGLRenderer;
			function initThree() {
				webGLRenderer = new THREE.WebGLRenderer();
				webGLRenderer.setSize(window.innerWidth, window.innerHeight);
				webGLRenderer.setClearColor(new THREE.Color(0x008080, 1.0));
				document.getElementById("WebGL-output").appendChild(webGLRenderer.domElement);
			}
			var camera;
			function initCamera() {
				camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
				camera.position.x = 30;
				camera.position.y = 100;
				camera.position.z = -100;
				camera.lookAt(scene.position);
			}
			/* 控制器 */
			var trackballControls;
			function initControls() {
				trackballControls = new THREE.TrackballControls(camera,webGLRenderer.domElement);
				trackballControls.rotateSpeed = 0.5; //旋转速度
				trackballControls.zoomSpeed = 0.5; // 缩放速度
				trackballControls.panSpeed = 0.5; // 平controls
				trackballControls.staticMoving = true; // 静止移动，为 true 则没有惯性
			}
			var spotLight;
			function initLight() {
				spotLight = new THREE.DirectionalLight(0xC0C0C0);
				spotLight.position.set(10, 10, -50);
				spotLight.intensity = 3;
				scene.add(spotLight);
			}
			let geometryArr = []
			function initObject() {
				var material = new THREE.PointCloudMaterial({
					size: 4,
					vertexColors: false,
					color: 0xff00ff
				});
				var index = 0;
				var indexX;
				var indexY;
				var indexZ;
				var loader = new THREE.OBJMTLLoader();
				var materialSprite = new THREE.SpriteMaterial();
				loader.load('meinumo.obj', 'meinumo.mtl', function(loadedMesh) {
						var materialSprite = new THREE.SpriteMaterial();
					var material = new THREE.MeshPhongMaterial({
						color: 0x664324,
						wireframe: false,
					})
					loadedMesh.children.forEach(function(child) {
						child.material = material;
						var color = new THREE.Color(0x444444);
						var faces = child.geometry.faces;
					});
					loadedMesh.scale.set(1, 1, 1);
					loadedMesh.position.set(0, -30, -30);
					scene.add(loadedMesh)
					var material = new THREE.PointCloudMaterial({
						size: 1,
						vertexColors: true,
						color: 0xffffff
					});
				});
			}

			var scene;
			var clock;
			function initScene() {
				clock = new THREE.Clock();
				scene = new THREE.Scene();
			}
			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				webGLRenderer.setSize(window.innerWidth, window.innerHeight);
				render();
			}
			function init() {
				initThree();
				initScene();
				initCamera();
				initLight();
				initObject();
				initControls();
				window.addEventListener("resize", onWindowResize, false);
				trackballControls.addEventListener('change', function() {
					console.log("相机动了！");
				});
				render();
			}
			function render() {
				var delta = clock.getDelta();
				trackballControls.update(delta);
				webGLRenderer.clear();
				requestAnimationFrame(render);
				webGLRenderer.render(scene, camera);
			}
			/* 初始加载 */
			(function() {
				init();
			})();
		</script>
	</body>

</html>